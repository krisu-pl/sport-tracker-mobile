"use strict";!function(){"use-strict";function t(t,e,n){t.state("login",{url:"/login","class":"login",templateUrl:"views/login.html",controller:"loginController"}).state("tracking",{url:"/tracking","class":"tracking",templateUrl:"views/tracking.html",controller:"trackingController",resolve:{}}),e.otherwise("/login")}var e=angular.module("sport-tracker-mobile",["ngCordova","ngStorage","ui.router"]);e.run(function(t){t.endpoint="http://192.168.43.4:3000/api/mobile"}),e.config(t)}(),angular.module("sport-tracker-mobile").factory("DataService",function(t){return{setActiveEvent:function(e){t.activeEvent=e},getActiveEvent:function(){return t.activeEvent},setActiveParticipant:function(e){t.activeParticipant=e},getActiveParticipant:function(){return t.activeParticipant},setSessionKey:function(e){t.sessionKey=e},getSessionKey:function(){return t.sessionKey},clearData:function(){t.activeEvent={},t.activeParticipant={},t.sessionKey=""}}}),angular.module("sport-tracker-mobile").service("EventService",function(t,e,n){this.getAll=function(){var i=t.defer();return e({method:"GET",url:n.endpoint+"/getAllEvents",withCredentials:!0}).then(function(t){t.data.error&&i.reject(t),i.resolve(t)},function(t){i.reject(t)}),i.promise}}),angular.module("sport-tracker-mobile").service("ParticipantService",function(t,e,n){this.login=function(i){var r=t.defer();return e({method:"POST",url:n.endpoint+"/login",data:i,withCredentials:!0}).then(function(t){t.data.error&&r.reject(t),r.resolve(t)},function(t){r.reject(t)}),r.promise}}),angular.module("sport-tracker-mobile").controller("loginController",function(t,e,n,i,r,a){e.events=[],e.init=function(){i.getAll().then(function(t){e.events=t.data})},e.onLogin=function(){var t={event_id:parseInt(e.event_id),starting_number:parseInt(e.starting_number),pin:parseInt(e.pin)},i=e.events.filter(function(t){return t.id==e.event_id});r.login(t).then(function(t){a.setActiveEvent(i[0]),a.setActiveParticipant(t.data.participant),a.setSessionKey(t.data.session_key),n.go("tracking")})}}),angular.module("sport-tracker-mobile").controller("trackingController",function(t,e,n,i,r,a,o){function c(){var t=moment().format("MMMM Do YYYY, hh:mm:ss"),e=document.getElementById("tracking_bottom");angular.element(e).prepend("<p><b>"+t+"</b> - Location sent.</p>")}function l(){function t(){var t=new Date,i=t-c,o="",l=void 0,u=void 0,v=void 0;i<0?(o="-",l=Math.ceil(i/a)*-1,u=Math.ceil(i%a/r)*-1,v=Math.ceil(i%r/n)*-1):(l=Math.floor(i/a),u=Math.floor(i%a/r),v=Math.floor(i%r/n)),e.data.eventTime=o+s(l)+":"+s(u)+":"+s(v)}var n=1e3,r=60*n,a=60*r,o=e.event.start_date,c=new Date(o);i(t,1e3)}function s(t){return("0"+t).slice(-2)}e.event={},e.participant={},e.data={eventActive:!1,trackingActive:!1,eventTime:"-"};var u=void 0,v=!1;e.$watch("data.eventTime",function(t,n){"-"!=t.substr(0,1)&&(e.data.eventActive=!0,e.data.trackingActive&&!v&&(u=i(c,1e3),v=!0))}),e.init=function(){e.event=o.getActiveEvent(),e.participant=o.getActiveParticipant(),(_.isEmpty(e.event)||_.isEmpty(e.participant))&&n.go("login"),l()},e.onStartTracking=function(){e.data.trackingActive=!0},e.onStopTracking=function(){e.data.trackingActive=!1,i.cancel(u),v=!1}});