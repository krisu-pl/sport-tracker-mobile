"use strict";!function(){"use-strict";function t(t,n,e){t.state("login",{url:"/login","class":"login",templateUrl:"views/login.html",controller:"loginController"}).state("tracking",{url:"/tracking","class":"tracking",templateUrl:"views/tracking.html",controller:"trackingController"}),n.otherwise("/login")}var n=angular.module("sport-tracker-mobile",["ngCordova","ngStorage","ui.router"]);n.run(function(t){t.endpoint="http://192.168.43.4:3000/api/mobile"}),n.config(t)}(),angular.module("sport-tracker-mobile").service("APIService",function(t,n,e){function i(t,i){var o=arguments.length<=2||void 0===arguments[2]?null:arguments[2];return new Promise(function(r,a){n({method:t,url:e.endpoint+i,data:o,withCredentials:!0}).then(function(t){r(t)},function(t){a(t)})})}this.login=function(t){return i("POST","/login",t)},this.getAllEvents=function(){return i("GET","/getAllEvents")},this.sendLocation=function(t){return i("POST","/sendLocation",t)}}),angular.module("sport-tracker-mobile").factory("DataService",function(t){return{setActiveEvent:function(n){t.activeEvent=n},getActiveEvent:function(){return t.activeEvent},setActiveParticipant:function(n){t.activeParticipant=n},getActiveParticipant:function(){return t.activeParticipant},setSessionKey:function(n){t.sessionKey=n},getSessionKey:function(){return t.sessionKey},clearData:function(){t.activeEvent={},t.activeParticipant={},t.sessionKey=""}}}),angular.module("sport-tracker-mobile").service("DeviceService",function(t,n,e,i){this.getCurrentPosition=function(){return new Promise(function(n,e){var i={timeout:1e4,enableHighAccuracy:!0};t.getCurrentPosition(i).then(function(t){var e=t.coords.latitude.toFixed(5),i=t.coords.longitude.toFixed(5);n({lat:e,lng:i})},function(t){e(t)})})}}),angular.module("sport-tracker-mobile").controller("loginController",function(t,n,e,i,o){n.events=[],n.init=function(){i.getAllEvents().then(function(t){n.events=t.data})},n.onLogin=function(){var t={event_id:parseInt(n.event_id),starting_number:parseInt(n.starting_number),pin:parseInt(n.pin)},r=n.events.filter(function(t){return t.id==n.event_id});i.login(t).then(function(t){o.setActiveEvent(r[0]),o.setActiveParticipant(t.data.participant),o.setSessionKey(t.data.session_key),e.go("tracking")})}}),angular.module("sport-tracker-mobile").controller("trackingController",function(t,n,e,i,o,r,a){function c(){function t(){return new Promise(function(t,n){a.getCurrentPosition.then(function(n){t(n)})["catch"](function(t){n(t)})})}function n(t){return new Promise(function(n,e){o.sendLocation.then(function(e){n({response:e,position:t})})["catch"](function(t){e(t)})})}var e=u(),i="";t.then(n).then(function(t){var n=(t.response,t.lat),o=t.lng;i="<p><b>"+e+"</b> - Location sent ("+n+", "+o+")</p>"})["catch"](function(t){console.error(t),i='<p class="error"><b>'+e+"</b> - "+t.message+"</p>"}).all(function(){f.prepend(i)})}function u(){return moment().format("DD.MM.YYYY, HH:mm:ss")}function s(){function t(){var t=new Date,i=t-c,a="",u=void 0,s=void 0,v=void 0;i<0?(a="-",u=Math.ceil(i/r)*-1,s=Math.ceil(i%r/o)*-1,v=Math.ceil(i%o/e)*-1):(u=Math.floor(i/r),s=Math.floor(i%r/o),v=Math.floor(i%o/e)),n.data.eventTime=a+l(u)+":"+l(s)+":"+l(v)}var e=1e3,o=60*e,r=60*o,a=n.event.start_date,c=new Date(a);i(t,1e3)}function l(t){return("0"+t).slice(-2)}n.event={},n.participant={},n.data={eventActive:!1,trackingActive:!1,eventTime:"-"};var v=void 0,g=!1,f=angular.element(document.getElementById("tracking_bottom"));n.$watch("data.eventTime",function(t,e){"-"!=t.substr(0,1)&&(n.data.eventActive=!0,n.data.trackingActive&&!g&&(v=i(c,1e3),g=!0))}),n.init=function(){n.event=r.getActiveEvent(),n.participant=r.getActiveParticipant(),(_.isEmpty(n.event)||_.isEmpty(n.participant))&&e.go("login"),s()},n.onStartTracking=function(){n.data.trackingActive=!0;var t=u(),e='<p class="info"><b>'+t+"</b> - Tracking enabled.</p>";f.prepend(e)},n.onStopTracking=function(){n.data.trackingActive=!1,i.cancel(v),g=!1;var t=u(),e='<p class="info"><b>'+t+"</b> - Tracking disabled.</p>";f.prepend(e)}});